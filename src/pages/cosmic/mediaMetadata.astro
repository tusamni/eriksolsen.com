---
import * as path from "path";

import Layout from "@/layouts/BaseLayout";

import { cosmic } from "@/library/cosmic";
import { getCollection } from "astro:content";

const folder = "2024-01-12-1970-porsche-911t-coupe";

const { media: cosmicMedia } = await cosmic.media.find({ folder: folder, type: "image/jpeg" });
const ccMedia = await getCollection("images", ({ slug }) => {
	return slug.includes(folder) === true;
});

for (const cm of cosmicMedia) {
	const cosmicWithoutExtension = path.basename(cm.original_name, path.extname(cm.original_name)); // remove extension from the cosmic filename
	const cosmicId = cm.id; // get the cosmic ID for updating

	const filteredCC = ccMedia.filter((m) => path.basename(m.slug) === cosmicWithoutExtension); // filter down the images content collection to find the exact image

	const metadata = {
		alt_text: filteredCC[0].data.description,
		metadata: {
			title: filteredCC[0].data.title,
			date: filteredCC[0].data.date,
			camera_make: filteredCC[0].data.cameraMake,
			camera_model: filteredCC[0].data.cameraModel,
			lens: filteredCC[0].data.lens,
			settings_f_stop: filteredCC[0].data.settingsfStop,
			settings_iso: filteredCC[0].data.settingsISO,
			settings_shutter: filteredCC[0].data.settingsShutter,
			settings_focal_length: filteredCC[0].data.settingsFocalLength,
		},
	};

	console.log(`${cosmicWithoutExtension} / ${cosmicId}`);
	console.log(filteredCC[0].slug);

	//await cosmic.media.updateOne(cosmicId, metadata);
}
---

<Layout />
