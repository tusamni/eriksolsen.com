---
// props
export interface Props {
    src: string;
    metadata?: boolean;
    sizes?: string;
    quality: number;
    loading: string;
    figureClass?: string;
}
const { src, metadata = true, sizes = "100vw", quality = 85, loading = "lazy", figureClass, ...attrs } = Astro.props;

// functions
import { getPublicPath, getSrcSet } from "@/functions/Media";

// load image data from content collection
import { getEntryBySlug } from "astro:content";
const image = await getEntryBySlug("images", src);

// build the srcset attribute
const srcset = await getSrcSet(src);
---

<div class:list={[figureClass, "overflow-hidden relative group"]}>
    {
        image ? (
            <img
                src={src}
                srcset={srcset}
                sizes={sizes}
                width={image.data.width}
                height={image.data.height}
                alt={image.data.description}
                loading={loading}
                {...attrs}
                data-img={getPublicPath(src)}
                data-alt={image.data.title}
                data-caption={image.data.description}
                data-width={image.data.width}
                data-height={image.data.height}
            />
        ) : (
            <img src={src} sizes={sizes} {...attrs} data-img={src} />
        )
    }

    {
        metadata && (
            <a href={`/photography/photo/${image.slug}`} title="View photo details" class="absolute bottom-0 rounded-tr-sm left-0 bg-white uppercase text-sm pl-3 pr-4 py-3 font-medium transition-all duration-200 no-underline">
                {image.data.title}
            </a>
        )
    }
</div>
