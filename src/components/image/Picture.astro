---
// imports
import { getImageDetails, getOptimizedImages } from "@/functions/Media";

// props
export interface Props {
    src: string;
    classes?: string;
}
const { src, classes, ...attrs } = Astro.props;

// get the image data
const image = await getImageDetails(src);

// create the optimized images
const optimizedJpeg = await getOptimizedImages(src);
const optimizedWebp = await getOptimizedImages(src, "webp");
const optimizedAvif = await getOptimizedImages(src, "avif");
---

<picture class:list={[classes]}>
    <source type="image/avif" srcset={optimizedAvif.srcSet.attribute} {...attrs} />
    <source type="image/webp" srcset={optimizedWebp.srcSet.attribute} {...attrs} />
    
    { image ?
        <img
            src={optimizedJpeg.src}
            srcset={optimizedJpeg.srcSet.attribute}
            width={image.data.width}
            height={image.data.height}
            data-img={optimizedJpeg.src}
            data-alt={image.data.title}
            data-caption={image.data.description}
            data-width={image.data.width}
            data-height={image.data.height}
            alt={image.data.description}
            {...attrs}
        />
    : 
        <img
            src={optimizedJpeg.src}
            srcset={optimizedJpeg.srcSet.attribute}
            {...attrs}
        />
    }
</picture>
