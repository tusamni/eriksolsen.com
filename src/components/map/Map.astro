---
// Map component for displaying Google Maps
// Usage: <Map locations={[{ name, address, lat, lng }]} />

interface Location {
	address: string;
	lat: number;
	lng: number;
	description?: string;
}

interface Props {
	title?: string;
	address?: string;
	lat: number;
	lon: number;
	mapId?: string;
	height?: string;
	zoom?: number;
	classes?: string;
}

const { title, address, lat, lon, mapId = "map", height = "400px", zoom = 12, classes } = Astro.props;

const apiKey = import.meta.env.PUBLIC_GOOGLE_MAPS_API_KEY;
const mapScript = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap&libraries=marker`;
---

<div id={mapId} class={classes}></div>

<script define:vars={{ lat, lon, mapId, title, address, zoom, mapScript }}>
	function initMap() {
		const position = { lat: Number(lat), lng: Number(lon) };

		const map = new google.maps.Map(document.getElementById(mapId), {
			zoom: zoom,
			center: position,
			mapId: "3effe2d4e7b071ce310ed0a7",
		});

		new google.maps.marker.AdvancedMarkerElement({
			position,
			map,
			title: title,
			gmpClickable: true,
		});
	}

	if (!window.google?.maps) {
		const script = document.createElement("script");
		script.src = mapScript;
		script.async = true;
		script.defer = true;
		window.initMap = initMap;
		document.head.appendChild(script);
	} else {
		initMap();
	}
</script>
