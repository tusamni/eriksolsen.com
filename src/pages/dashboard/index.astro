---
// layout
import Layout from "@/layouts/BaseLayout";

// components
import { supabase } from "@/library/supabase";
import Container from "@/components/content/Container";
import Split from "@/components/content/Split";
import Section from "@/components/content/Section";

const { cookies, redirect } = Astro;

const accessToken = cookies.get("sb-access-token");
const refreshToken = cookies.get("sb-refresh-token");

if (!accessToken || !refreshToken) {
    return redirect("/login");
}

const { data, error } = await supabase.auth.setSession({
    refresh_token: refreshToken.value,
    access_token: accessToken.value,
});

if (error) {
    cookies.delete("sb-access-token", {
        path: "/",
    });
    cookies.delete("sb-refresh-token", {
        path: "/",
    });

    return redirect("/login");
}
---

<Layout title="Car Photographer in Austin, TX - I Shoot Professional Car Photos for Your Online Auction." footerPadding={true} navPadding={false}>
    <Container classes="mt-20">
        <Split size="small">
            <div slot="heading">
                <div class="bg-gray-100 rounded p-6 text-gray-900 space-y-4">
                    <div class="font-medium uppercase">Dashboard</div>
                    <ul class="space-y-3">
                        <li class="text-base">
                            Posts
                            <ul class="mt-2 ml-4 text-sm space-y-1">
                                <li>All posts</li>
                                <li>Add new post</li>
                            </ul>
                        </li>
                        <li class="text-base">Shoots</li>
                    </ul>
                </div>
            </div>

            <div>Admin Stuff</div>
        </Split>
    </Container>
</Layout>
