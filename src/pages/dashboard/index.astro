---
// layout
import Layout from "@/layouts/BaseLayout";

// components
import { supabase } from "@/library/supabase";
import Container from "@/components/content/Container";
import Heading from "@/components/content/Heading";
import Section from "@/components/content/Section";

const { cookies, redirect } = Astro;

const accessToken = cookies.get("sb-access-token");
const refreshToken = cookies.get("sb-refresh-token");

if (!accessToken || !refreshToken) {
    return redirect("/login");
}

const { data, error } = await supabase.auth.setSession({
    refresh_token: refreshToken.value,
    access_token: accessToken.value,
});

if (error) {
    cookies.delete("sb-access-token", {
        path: "/",
    });
    cookies.delete("sb-refresh-token", {
        path: "/",
    });

    return redirect("/login");
}
---

<Layout title="Car Photographer in Austin, TX - I Shoot Professional Car Photos for Your Online Auction." footerPadding={true}>
    <Section>
        <Container />
    </Section>
</Layout>
