---
// layout
import Layout from "@/layouts/BaseLayout";

// components
import { cosmic } from "@/library/cosmic";
import { Markdown } from "astro-remote";
import { timeAgo, formatDate } from "@/functions/DateTime";
import Container from "@/components/content/Container";
import Figure from "@/components/image/Figure";
import Heading from "@/components/content/Heading";
import Related from "@/components/blog/related/Primary";
import Section from "@/components/content/Section";
import Split from "@/components/content/Split";

// content
export async function getStaticPaths() {
	const { objects: blogs } = await cosmic.objects.find({ type: "blogs" }).props("title, slug, metadata").depth(1);

	return blogs.map((blog) => ({
		params: { slug: blog.slug },
		props: { blog },
	}));
}
const { blog } = Astro.props;
---

<Layout title={blog.title} description={blog.metadata.seo.description}>
	<Section>
		<Container>
			<Heading>
				<h1 slot="heading">{blog.title}</h1>
				<div slot="middle" class="flex flex-row gap-3">
					<time class="pill pill-secondary" datetime={formatDate(blog.metadata.date)}>
						{timeAgo(new Date(blog.metadata.date))}
					</time>

					<div class="pill pill-primary">{blog.metadata.category.value}</div>
				</div>
				<div slot="description" set:html={blog.metadata.excerpt} />
			</Heading>
		</Container>

		<Container>
			<Split size="large" float={true} reverse={true}>
				<div slot="heading" class="space-y-20 w-4/5">
					<!-- {
						related && (
							<div class="space-y-8">
								<div class="h4">Related Posts</div>
								{related.data.map((r) => (
									<Related post={r} />
								))}
							</div>
						)
					} -->
				</div>

				<article class="prose prose-lg">
					<Markdown content={blog.metadata.post} sanitize={{ allowComponents: true }} components={{ Figure }} />
				</article>
			</Split>
		</Container>
	</Section>
</Layout>
