---
// Map component for displaying Google Maps
// Usage: <Map locations={[{ name, address, lat, lng }]} />

interface Location {
    name: string;
    address: string;
    lat: number;
    lng: number;
    description?: string;
}

interface Props {
    locations: Location[];
    mapId?: string;
    height?: string;
    zoom?: number;
}

const { locations, mapId = "map", height = "400px", zoom = 12 } = Astro.props;
---

<div id={mapId} style={`height: ${height}; width: 100%;`}></div>

<script define:vars={{ locations, mapId, zoom }}>
    // Initialize Google Map
    function initMap() {
        if (!window.google || !window.google.maps) {
            console.error("Google Maps API not loaded");
            return;
        }

        // Calculate center point (average of all locations)
        const center = {
            lat: locations.reduce((sum, loc) => sum + loc.lat, 0) / locations.length,
            lng: locations.reduce((sum, loc) => sum + loc.lng, 0) / locations.length,
        };

        const map = new google.maps.Map(document.getElementById(mapId), {
            zoom: zoom,
            center: center,
            mapTypeControl: true,
            fullscreenControl: true,
            streetViewControl: true,
        });

        // Add markers for each location
        locations.forEach((location) => {
            const marker = new google.maps.Marker({
                position: { lat: location.lat, lng: location.lng },
                map: map,
                title: location.name,
            });

            // Add info window
            const infoWindow = new google.maps.InfoWindow({
                content: `
          <div style="padding: 8px; font-family: Arial, sans-serif;">
            <h3 style="margin: 0 0 4px 0; font-size: 16px;">${location.name}</h3>
            <p style="margin: 0 0 4px 0; font-size: 14px;">${location.address}</p>
            ${location.description ? `<p style="margin: 0; font-size: 13px; color: #666;">${location.description}</p>` : ""}
          </div>
        `,
            });

            marker.addListener("click", () => {
                // Close other info windows would go here if tracking them
                infoWindow.open(map, marker);
            });
        });
    }

    // Wait for Google Maps API to load
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initMap);
    } else {
        initMap();
    }
</script>

<style>
    :global(#map) {
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
</style>
